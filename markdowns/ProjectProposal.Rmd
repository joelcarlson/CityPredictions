---
title: "Final Project Proposal"
author: "Joel Carlson"
date: "June 14, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Gentrificationometer!

# High Level description

I wish to address the issue of understanding when are area is gentrifying and some of the factors that lead up to this. It would be ideal to be able to know when rents or sale prices in your neighborhood may go up (or even down!). 

My prediction target for this would be median rent in a given neighborhood in a given year. Furthermore, I would look to predict the difference between listing and sale price for a given unit in a given area. I will accomplish this by integrating a number of data sets from a number of sources, and using time series modeling techniques to find trends. This will all be accomplished for the city of NY.

# Process

I will build a model that predicts the median rental price (or sale price) in an area given a number of external factors such as:

  - The number, and change in number of taxi pickups and dropoffs in the neighborhood over a number of years
  - Changes in the number of business or liquor licenses awarded in an area
  - Proximity to a number of amenities
  
The median rental and sale prices are provided in two forms:

  - Zillow open research data
    - Sold prices going back to the mid 90's
    - Listing prices to 2010
  - NYC valuation and tax assessment data
  
Due to the number of sources involved, I expect that significant time will be spent cleaning and integrating the data:

### Data Pipeline

#### Zillow Data

Zillow provides median selling, listing, and rental prices for apartments, condos, and homes for a number of cities. This data is relatively clean, but there are large sections of missing data. I will interpolate missing values where possible by modeling the trends in the data.

The data is interesting, and there appear to be interesting trends in the median selling and listing prices over the past several years:

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr); library(reshape2); library(ggplot2)
filter_zillow_data <- function(dat, date_start=7){
  # Only new york
  dat <- filter(dat, State=="NY",  City=="New York")

  # Prepare for plotting
  dat_m <- melt(dat, id.vars=c("RegionName"),
                measure.vars=colnames(dat)[date_start:length(colnames(dat))])
  
  # Make more date-ey, paste on a day to make it unambiguous
  dat_m$variable <- sapply(as.character(dat_m$variable),
                           function(x) paste(substr(x, 2, nchar(x)),".01",
                                             sep="") )
  dat_m$date <- as.Date(dat_m$variable, format="%Y.%m.%d")
  return(dat_m)
}
Neighborhood_MedianListingPrice_AllHomes <- read.csv("~/Documents/github/CityPredictions/data/Zillow/Neighborhood_MedianListingPrice_AllHomes.csv")

dat_med_listing <- filter_zillow_data(Neighborhood_MedianListingPrice_AllHomes)


Neighborhood_MedianSoldPrice_AllHomes <- read.csv("~/Documents/github/CityPredictions/data/Zillow/Neighborhood_MedianSoldPrice_AllHomes.csv")

dat_med_sold <- filter_zillow_data(Neighborhood_MedianSoldPrice_AllHomes, date_start=8)
median_sell = dat_med_sold %>% group_by(date) %>% summarize("Median_Sell"=median(value, na.rm=TRUE))

median_list = dat_med_listing %>% group_by(date) %>% summarize("Median_Listing"=median(value, na.rm=TRUE))

medians <- merge(median_sell, median_list, by="date")
medians$Difference <- medians$Median_Sell - medians$Median_Listing
medians <- melt(medians, id.vars="date")
ggplot(data=filter(medians, variable != "Difference"), aes(x=date, y=value, group=variable, col=variable)) + 
  geom_line() + 
  geom_smooth() +
  labs(x="Year", y="Price ($)") +
  theme(legend.title=element_blank()) +
  ggtitle("Difference in Median Listing and Sale Price for All NY Areas") 
```

#### NYC Valuation Data

The NYC valuation data is stored in several large MongoDB databases. I have not yet explored it

  - Source 1: https://data.cityofnewyork.us/Housing-Development/Property-Valuation-and-Assessment-Data/rgy2-tti8
  - Source 2: https://data.cityofnewyork.us/City-Government/Notice-of-Property-Value-NOPV-/8vgb-zm6e


### Taxi Data

I have acquired ~100 GBs of taxi pickup and dropoff location for the city of NY. It will be an extreme challenge to process this data, but I believe that once it is aggregated, it will be of reasonable size.

### Liquor Licenses

I am in the process of scraping this data. I have already brought down the server once by mistake, but my script has been chugging along nicely for the past several hours. If that doesn't work out, then this will not be used as a source of data.

![alt text](Images/NY_by_liquor.png)

### Amenities Data

I have downloaded a series of geolocations in XML format of the locations of desirable amenities in new york (public parks, swimming pools, rec-centers, tennis courts, etc). I would like to create a function that calculates the minimum distance to each amenity for each location (on a discretized map of NY). These distances would then be used as features in the model.

# Problems

As stated above, cleaning and combining the data will be a challenge. From what I have seen the data is reasonable enough, and I am confident that I will be able to combine it eventually.

The taxi data is extremely alrge, finding a way to process the data will be difficult - some sort of streaming solution will likely be the best way to tackle it.

# Deliverable

I will create a working web app which would present a map of a city and allow the user to adjust the year that is being displayed. There would be an overlay of predicted rent prices by area that would change with the year, and in this way the "flow" of money in a city may be visualized.

### Next Steps

Acquiring the data, building models, creating a web app!

### Data

Liquor license data can be acquired here by entering a zip code (NYC) and then scraping the results:
  - https://www.tran.sla.ny.gov/JSP/query/PublicQueryPremisesSearchPage.jsp

Some taxi and for-hire-vehicle data exists here:
  - https://github.com/fivethirtyeight/uber-tlc-foil-response
And more here:
  - http://www.andresmh.com/nyctaxitrips/
Wifi data here:
  - https://catalog.data.gov/dataset/nyc-wi-fi-hotspot-locations-9a8e0

Property valuation data for NYC here:
  - https://data.cityofnewyork.us/Housing-Development/Property-Valuation-and-Assessment-Data/rgy2-tti8

Lots of other interesting data:
  - https://nycopendata.socrata.com/data?cat=housing%20%26%20development

It's so interesting!
https://data.cityofnewyork.us/Housing-Development/DOF-Condominium-Comparable-Rental-Income-Manhattan/ad4c-mphb

http://furmancenter.org/data
